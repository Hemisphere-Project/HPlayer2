<!DOCTYPE HTML>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>HPlayer2 - player</title>

  <script type="text/javascript" src="/res/jquery-3.3.1.min.js"></script>
  <script type="text/javascript" src="/res/socket.io.slim.js"></script>

  <link href="/res/css/fontawesome.min.css" rel="stylesheet">
  <link href="/res/css/solid.min.css" rel="stylesheet">
  <link href="/res/css/regular.min.css" rel="stylesheet">

  <link rel="stylesheet" href="/res/bootstrap.min.css">
  <script type="text/javascript" src="/res/bootstrap.bundle.min.js"></script>

  <link rel="stylesheet" href="/res/bootstrap-treeview.min.css">
  <script type="text/javascript" src="/res/bootstrap-treeview-custom.js"></script>

  <link rel="stylesheet" href="/res/jquery.dm-uploader.min.css">
  <script type="text/javascript" src="/res/jquery.dm-uploader.min.js"></script>
  <script type="text/javascript" src="/res/uploader-profile.js"></script>

  <link rel="stylesheet" href="/style.css?6">
  
</head>

<body>
  <nav class="navbar navbar-dark bg-dark mb-3">
    <span class="navbar-brand mb-0 mr-0 h1">HPlayer2</span>
    <span id="playerName"></span>
    <span id="link-connected">connected</span>
    <span id="link-disconnected">disconnected</span>
  </nav>

  <div class="row panel">
    <div class="col-sm-0 col-md-1 col-lg-2 col-xl-3"></div>
    <div class="col-sm-12 col-md-10 col-lg-8 col-xl-6">

      <div class="row">
        <div class="col-12 col-sm-5">
          <div class="form-group">
            <button type="button" class="btn btn-outlined-warning" id="pause_btn"><i class="fas fa-pause"></i></button>
            <button type="button" class="btn btn-outlined-danger" id="stop_btn"><i class="fas fa-stop"></i></button>
          </div>
        </div>

        <div class="col-12 col-sm-7">
          <div class="">
            <span class="badge badge-secondary mr-2 vol-main">volume</span><span id="volumeMain"></span>
            <input type="range" class="" id="volume_range" min="0" max="100">
          </div>
        </div>
      </div>
      <hr />

      <div class="row mt-2">
        <div class="col-12 mb-4">
          <div id="playlist" class=""></div>
        </div>
      </div>
    
      <div class="row mt-2">
        <div class="col-12 mb-4">
              <div id="trees" class="row mt-2"></div>
            </div>

        </div>
      </div>

    </div>
  </div>
  
  <script type="text/javascript" src="/script.js"></script>
  <script>

    /* Monkey patch script.js */
    
    // Selecting becomes PLAYSYNC
    //
    socket.on('files', function(msg) 
    {
      var tree = $('#filestree')
      tree.on('nodeSelected', function(event, data) {
          socket.emit('user', 'playsync', data.path)
          tree.treeview('unselectAll')
          // tree.treeview('selectNode', [ data.nodeId, { silent: true } ])
       });
       tree.treeview('collapseAll')
      // $.each( $('#filestree').data('treeview').getNodes(), (i, node) => {
      //   node.selectable = false
      // })
    })

    // Make command sync
    //
    $('#volume_range').unbind('input').on('input', function() {
      socket.emit('user', 'volumesync', this.value)
    })

    $('#pause_btn').unbind('click').on('click', function() {
      if(!last_status['isPaused']) socket.emit('user', 'pausesync');
      else socket.emit('user', 'resumesync');
    });

    $('#play_btn').unbind('click').on('click', function() {
      socket.emit('user', 'playsync');
    });

    $('#stop_btn').unbind('click').on('click', function() {
      socket.emit('user', 'stopsync');
    });
    

    // Clear playlist on media end
    //
    // socket.on('status', function(msg) {
    //   if (!msg['isPlaying'] && !msg['isPaused']) {
    //     var playlist = $('#playlist>ul').children()
    //     if (playlist.length > 0) socket.emit('clear')
    //   }
    // })

  </script>

  <style>
    .media-edit, .filesBar {
      display: none;
    }
  </style>
</body>

</html>

